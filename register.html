<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <title>Registration - Cahaya Az Zahra Enterprise</title>
  <link rel="stylesheet" href="styles/main.css">
  <style>
    .registration-page {
      max-width: 700px;
      animation: slideIn 0.3s ease-out;
    }
    
    .double-column {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .file-input-group {
      border: 2px dashed var(--primary-color);
      padding: 1rem;
      margin: 1rem 0;
    }

    @media (max-width: 768px) {
      .double-column {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container registration-page">
    <h1>New User Registration</h1>
    
    <form id="registrationForm">
      <!-- Phone & Password Section -->
      <div class="double-column">
        <div class="input-group">
          <label for="phone">Phone Number</label>
          <input type="tel" id="phone" 
                 pattern="^(673\d{7}|60\d{9,})$"
                 required>
          <div class="error-message" id="phoneError"></div>
        </div>

        <div class="input-group">
          <label for="password">Password</label>
          <input type="password" id="password" 
                 pattern="^(?=.*[A-Z])(?=.*\d).{6,}$"
                 required>
          <div class="error-message" id="passwordError"></div>
        </div>
      </div>

      <!-- Email Section -->
      <div class="double-column">
        <div class="input-group">
          <label for="email">Email</label>
          <input type="email" id="email" required>
        </div>
        
        <div class="input-group">
          <label for="confirmEmail">Confirm Email</label>
          <input type="email" id="confirmEmail" required>
          <div class="error-message" id="emailError"></div>
        </div>
      </div>

      <!-- Personal Information -->
      <div class="input-group">
        <label for="fullName">Full Name</label>
        <input type="text" id="fullName" required>
      </div>

      <div class="double-column">
        <div class="input-group">
          <label for="address">Address</label>
          <input type="text" id="address" required>
        </div>
        
        <div class="input-group">
          <label for="postcode">Postcode</label>
          <input type="text" id="postcode" required>
        </div>
      </div>

      <!-- IC Section -->
      <div class="input-group">
        <label for="icNumber">IC Number</label>
        <input type="text" id="icNumber" 
               pattern="\d{2}-\d{6}|\d{6}-\d{2}-\d{4}"
               required>
        <div class="error-message" id="icError"></div>
      </div>

      <!-- File Uploads -->
      <div class="file-input-group">
        <div class="input-group">
          <label for="frontIC">Front IC (Image/PDF)</label>
          <input type="file" id="frontIC" accept="image/*,.pdf" required>
        </div>
        
        <div class="input-group">
          <label for="backIC">Back IC (Image/PDF)</label>
          <input type="file" id="backIC" accept="image/*,.pdf" required>
          <div class="error-message" id="fileError"></div>
        </div>
      </div>

      <button type="submit" class="gold-button">Complete Registration</button>
    </form>

    <div id="registrationMessage" class="message"></div>
  </div>

  <script src="scripts/app.js"></script>
  <script>
  // Add registration-specific validation to app.js
  function initRegistration() {
    const form = document.getElementById('registrationForm');
    if(form) {
      form.addEventListener('submit', handleRegistrationSubmit);
      setupICFormatting();
    }
  }

  function setupICFormatting() {
    document.getElementById('icNumber').addEventListener('input', function(e) {
      let value = e.target.value.replace(/-/g, '');
      if (value.length > 2 && value.length <= 8) {
        value = value.slice(0,2) + '-' + value.slice(2);
      } else if (value.length > 8) {
        value = value.slice(0,6) + '-' + value.slice(6,8) + '-' + value.slice(8,12);
      }
      e.target.value = value;
    });
  }

  async function handleRegistrationSubmit(e) {
    e.preventDefault();
    showLoading(true);

    try {
      if(!validateRegistrationForm()) return;

      const formData = {
        icNumber: document.getElementById('icNumber').value,
        phone: document.getElementById('phone').value,
        password: document.getElementById('password').value,
        email: document.getElementById('email').value,
        fullName: document.getElementById('fullName').value,
        address: document.getElementById('address').value,
        postcode: document.getElementById('postcode').value,
        frontIC: await fileToBase64(document.getElementById('frontIC').files[0]),
        backIC: await fileToBase64(document.getElementById('backIC').files[0]),
        frontICType: document.getElementById('frontIC').files[0].type,
        backICType: document.getElementById('backIC').files[0].type
      };

      const response = await callAPI('registerUser', formData);
      
      if(response.success) {
        showSuccessMessage('Registration successful! Redirecting...');
        setTimeout(() => safeRedirect('login.html'), 2000);
      } else {
        showError(response.message || 'Registration failed');
      }
    } catch(error) {
      showError(`Registration Error: ${error.message}`);
    } finally {
      showLoading(false);
    }
  }

  // Add to DOMContentLoaded in app.js
  document.addEventListener('DOMContentLoaded', () => {
    initRegistration();
    // Other initializations...
  });
  </script>
</body>
</html>
